<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Henia Cisneros ‚Äî Libro (versi√≥n final corregida)</title>
<style>
:root{
  --desk-1:#5a3d2a; --desk-2:#8a6242;
  --leather-1:#32171f; --leather-2:#4a2330;
  --gold:#c9a84f;
  --paper:#fbf6ec; --paper-edge:#e5d6bf;
  --leaf-thick:8px;
  --book-w:760px; --book-h:460px;
}

/* Reset */
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family: 'Cormorant Garamond', Georgia, serif;
  background: linear-gradient(180deg,var(--desk-1),var(--desk-2));
  display:flex;align-items:center;justify-content:center;overflow:hidden;color:#2f241f}

/* Scene */
.scene{ width:94vw; max-width:1280px; height:86vh; display:flex;align-items:center;justify-content:center; padding:24px; perspective:2800px; }

/* Book wrapper */
.book-wrap{ width:var(--book-w); height:var(--book-h); max-width:92%; max-height:86%; position:relative; transform: rotateX(6deg); }
/* subtle desk texture */
.book-wrap::before{ content:""; position:absolute; inset:-40px; background:url('https://images.unsplash.com/photo-1505691723518-36a45b89acb1?auto=format&fit=crop&w=1600&q=80') center/cover; opacity:0.08; z-index:0; border-radius:10px; }

/* shadow under book */
.book-shadow{ position:absolute; left:50%; transform:translateX(-50%); bottom:-22px; width:70%; height:34px; background: radial-gradient(closest-side, rgba(0,0,0,0.6), transparent); filter:blur(22px); z-index:1; }

/* Book (stack centered on spine) */
.book{ width:100%; height:100%; position:relative; transform-style:preserve-3d; z-index:10; }

/* spine behind (ensure it's BELOW cover by z-index) */
.spine{ position:absolute; left:50%; top:8px; width:28px; height:calc(100% - 16px); transform:translateX(-50%); background: linear-gradient(180deg,#2b161b,#4a2a36); border-radius:6px; z-index:50; box-shadow: inset 0 2px 6px rgba(255,255,255,0.02); pointer-events:none; opacity:0.95; }

/* stack (all leaves) centered on spine */
.stack{ position:absolute; inset:0; left:50%; transform:translateX(-50%); width:100%; height:100%; transform-style:preserve-3d; z-index:100; }

/* leaf (a physical sheet) */
.leaf{ position:absolute; left:0; top:0; width:100%; height:100%; transform-style:preserve-3d; backface-visibility:hidden;
  transition: transform 780ms cubic-bezier(.2,.9,.25,1), box-shadow 240ms; will-change:transform; cursor:pointer; }

/* thickness edge on right (visible when closed) */
.leaf::after{ content:""; position:absolute; right:-var(--leaf-thick); top:6px; bottom:6px; width:var(--leaf-thick);
  background: linear-gradient(180deg, rgba(0,0,0,0.06), rgba(0,0,0,0.02)); border-radius:3px; }

/* face (front) */
.face{ position:absolute; inset:0; padding:20px; box-sizing:border-box; border-radius:8px;
  display:flex; gap:16px; align-items:center; justify-content:space-between;
  background: linear-gradient(180deg,var(--paper), #f6eadc);
  border:1px solid rgba(0,0,0,0.06); backface-visibility:hidden; }

/* backface (content when leaf flipped) */
.back{ position:absolute; inset:0; padding:20px; box-sizing:border-box; border-radius:8px; display:flex; align-items:center; justify-content:center;
  background: linear-gradient(180deg,var(--paper), #f6eadc); transform:rotateY(180deg); backface-visibility:hidden; }

/* cover styling (leaf 0) */
.leaf.cover .face{ background: linear-gradient(180deg,var(--leather-1),var(--leather-2)); color:var(--gold); border-radius:10px; border:3px solid rgba(0,0,0,0.36);
  box-shadow: 0 20px 70px rgba(0,0,0,0.55), inset 0 6px 18px rgba(255,255,255,0.02); display:flex; align-items:center; justify-content:center; flex-direction:column; text-align:center; }

/* backcover style */
.leaf.backcover .face{ background: linear-gradient(180deg,var(--leather-2),var(--leather-1)); border-radius:10px; border:3px solid rgba(0,0,0,0.34); }

/* columns */
.col{ width:48%; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; gap:10px; text-align:center; }
.col img{ width:100%; height:auto; max-height:48%; object-fit:cover; border-radius:8px; box-shadow: 0 6px 18px rgba(0,0,0,0.12) inset; }
.midtext{ color:#3b2d26; font-size:1rem; line-height:1.45; }

/* center column for single-column pages */
.center{ width:100%; display:flex; align-items:center; justify-content:center; }

/* flipped class rotates leaf around spine to show back */
.leaf.flipped{ transform: rotateY(-180deg); box-shadow: 0 6px 40px rgba(0,0,0,0.08); }

/* ensure cover sits above everything when closed */
.leaf.cover{ z-index:1200; }

/* micro-lift hover */
.leaf:not(.flipped):hover{ transform: translateZ(8px); }

/* controls under book */
.controls{ position:absolute; left:50%; transform:translateX(-50%); bottom:-80px; display:flex; gap:12px; z-index:600; }
.btn{ padding:10px 14px; border-radius:10px; background: linear-gradient(#fff,#f4efe4); border:1px solid rgba(0,0,0,0.06); font-weight:700; cursor:pointer; box-shadow: 0 10px 28px rgba(0,0,0,0.16); }

/* responsive tweaks */
@media (max-width:960px){ :root{ --book-w:88vw; --book-h:56vw; } .controls{ bottom:-96px; } }
@media (max-width:520px){ .col img{ max-height:32%; } :root{ --leaf-thick:6px; } }
</style>
</head>
<body>
  <div class="scene">
    <div class="book-wrap" id="bookWrap" aria-label="Libro de regalo">
      <div class="book-shadow" aria-hidden="true"></div>

      <div class="book" id="book">
        <div class="spine" aria-hidden="true"></div>

        <div class="stack" id="stack">
          <!-- Cover (leaf 0) -->
          <div class="leaf cover" data-index="0" aria-label="Portada">
            <div class="face">
              <div style="width:100%; text-align:center;">
                <h1 style="margin:0; font-size:2.8rem; color:var(--gold); text-shadow:0 4px 10px rgba(0,0,0,0.6);">Henia Cisneros</h1>
                <p style="margin:12px 0 0 0; color:rgba(255,235,180,0.95); font-size:1.05rem;">Con todo mi cari√±o en tu cumplea√±os</p>
              </div>
            </div>
            <div class="back"><div style="width:100%;height:100%"></div></div>
          </div>

          <!-- Leaf 1 -->
          <div class="leaf" data-index="1" aria-label="Hoja 1">
            <div class="face">
              <div class="col">
                <img src="img/pagina1_left.jpg" alt="izq 1"><div class="midtext">Foto izquierda 1</div>
              </div>
              <div class="col">
                <img src="img/pagina1_right.jpg" alt="der 1"><div class="midtext">Foto derecha 1</div>
              </div>
            </div>
            <div class="back"><div style="text-align:center; color:#3b2d26;">Breve texto o dedicatoria (reverso).</div></div>
          </div>

          <!-- Leaf 2 -->
          <div class="leaf" data-index="2" aria-label="Hoja 2">
            <div class="face">
              <div class="col">
                <img src="img/pagina2_left.jpg" alt="izq 2"><div class="midtext">Foto izquierda 2</div>
              </div>
              <div class="col">
                <img src="img/pagina2_right.jpg" alt="der 2"><div class="midtext">Foto derecha 2</div>
              </div>
            </div>
            <div class="back"><div style="text-align:center; color:#3b2d26;">Otro texto bonito (reverso).</div></div>
          </div>

          <!-- Leaf 3 (dedicatoria) -->
          <div class="leaf" data-index="3" aria-label="Dedicatoria">
            <div class="face">
              <div class="center">
                <div style="max-width:72%; text-align:center;">
                  <p style="font-size:1.05rem; margin:0 0 10px 0; color:#3b2d26;">Que nunca falte la alegr√≠a y el amor en tu vida.</p>
                  <p style="font-weight:700; margin:8px 0 0 0;">Con cari√±o,<br>Manuel</p>
                </div>
              </div>
            </div>
            <div class="back"><div></div></div>
          </div>

          <!-- Backcover (leaf last) -->
          <div class="leaf backcover" data-index="4" aria-label="Contraportada">
            <div class="face"><div style="text-align:center; color:rgba(255,235,180,0.92)">&nbsp;</div></div>
            <div class="back"><div></div></div>
          </div>
        </div><!-- /stack -->
      </div><!-- /book -->

      <!-- controls -->
      <div class="controls" id="controls">
        <button class="btn" id="prevBtn">‚üµ Atr√°s</button>
        <button class="btn" id="nextBtn">Siguiente ‚ü∂</button>
        <button class="btn" id="resetBtn">‚§∫ Reiniciar</button>
        <button class="btn" id="audioBtn">üîà M√∫sica</button>
      </div>

    </div>
  </div>

  <!-- audio -->
  <audio id="pageSound" preload="auto"><source src="https://www.soundjay.com/books/page-turn-4.mp3" type="audio/mpeg"></audio>
  <audio id="bgMusic" preload="auto" loop><source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_efc06752a0.mp3?filename=soft-piano-ambient-112191.mp3" type="audio/mpeg"></audio>

<script>
(function(){
  const stack = document.getElementById('stack');
  const leaves = Array.from(stack.querySelectorAll('.leaf'));
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const resetBtn = document.getElementById('resetBtn');
  const audioBtn = document.getElementById('audioBtn');
  const pageSound = document.getElementById('pageSound');
  const bgMusic = document.getElementById('bgMusic');

  let current = 0;
  let audioOn = false;
  let isAnimating = false;

  function init(){
    // cover must be on top when closed
    for(let i=0;i<leaves.length;i++){
      const z = 1200 - i;
      leaves[i].style.zIndex = z;
      leaves[i].classList.remove('flipped');
      leaves[i].style.transform = 'rotateY(0deg)';
      leaves[i].style.transition = 'transform 780ms cubic-bezier(.2,.9,.25,1), box-shadow 240ms';
      leaves[i].style.willChange = 'transform';
    }
    // ensure spine is behind cover (cover z higher)
    // (spine is separate in CSS with lower z)
    current = 0;
  }
  init();

  // preload imgs
  function preloadImages(){
    const imgs = Array.from(document.querySelectorAll('.face img'));
    return Promise.all(imgs.map(img=>{
      return new Promise(res=>{
        if(!img || !img.src) return res();
        const i = new Image(); i.onload = i.onerror = res; i.src = img.src;
      });
    }));
  }

  function playPageSound(){
    try{ if(audioOn){ pageSound.currentTime=0; pageSound.play().catch(()=>{}); } }catch(e){}
  }

  function flipNext(){
    if(isAnimating) return;
    if(current >= leaves.length) return;
    isAnimating = true;
    const leaf = leaves[current];
    leaf.style.zIndex = 2000;
    // flip
    requestAnimationFrame(()=>{ leaf.classList.add('flipped'); leaf.style.transform = 'rotateY(-180deg)'; });
    playPageSound();
    const done = (ev) => {
      if(ev && ev.target !== leaf) return;
      leaf.removeEventListener('transitionend', done);
      leaf.style.zIndex = 10 + current;
      current++;
      isAnimating = false;
    };
    leaf.addEventListener('transitionend', done);
    setTimeout(()=>{ if(isAnimating){ leaf.removeEventListener('transitionend', done); leaf.style.zIndex = 10 + current; current++; isAnimating=false; } }, 900);
  }

  function flipPrev(){
    if(isAnimating) return;
    if(current <= 0) return;
    isAnimating = true;
    const idx = current - 1;
    const leaf = leaves[idx];
    leaf.style.zIndex = 2000;
    requestAnimationFrame(()=>{ leaf.classList.remove('flipped'); leaf.style.transform = 'rotateY(0deg)'; });
    playPageSound();
    const done = (ev) => {
      if(ev && ev.target !== leaf) return;
      leaf.removeEventListener('transitionend', done);
      init(); // safe restore stacking
      isAnimating = false;
    };
    leaf.addEventListener('transitionend', done);
    setTimeout(()=>{ if(isAnimating){ leaf.removeEventListener('transitionend', done); init(); isAnimating=false; } }, 900);
    current = idx;
  }

  function resetBook(){
    if(isAnimating) return;
    isAnimating = true;
    leaves.forEach((leaf,i)=>{ leaf.classList.remove('flipped'); leaf.style.transform='rotateY(0deg)'; leaf.style.zIndex = 1200 - i; });
    setTimeout(()=>{ init(); isAnimating=false; }, 420);
  }

  function toggleAudio(){
    audioOn = !audioOn;
    if(audioOn){ bgMusic.volume = 0.22; bgMusic.play().catch(()=>{}); audioBtn.textContent='üîä M√∫sica ON'; try{ pageSound.currentTime=0; pageSound.play().catch(()=>{}); }catch(e){} }
    else { bgMusic.pause(); audioBtn.textContent='üîà M√∫sica'; }
  }

  nextBtn.addEventListener('click', flipNext);
  prevBtn.addEventListener('click', flipPrev);
  resetBtn.addEventListener('click', resetBook);
  audioBtn.addEventListener('click', toggleAudio);

  // click on stack: right->next, left->prev
  stack.addEventListener('click',(ev)=>{
    if(isAnimating) return;
    const rect = stack.getBoundingClientRect();
    const x = ev.clientX - rect.left;
    if(x > rect.width * 0.62) flipNext();
    else if(x < rect.width * 0.38) flipPrev();
    else flipNext();
  });

  // touch swipe
  let startX=0, startY=0, moved=false;
  stack.addEventListener('touchstart', e=>{ const t=e.touches[0]; startX=t.clientX; startY=t.clientY; moved=false; }, {passive:true});
  stack.addEventListener('touchmove', ()=>{ moved=true; }, {passive:true});
  stack.addEventListener('touchend', e=>{
    if(isAnimating) return;
    const t = e.changedTouches[0];
    const dx = t.clientX - startX, dy = t.clientY - startY;
    if(Math.abs(dx) > 30 && Math.abs(dx) > Math.abs(dy)){ if(dx < 0) flipNext(); else flipPrev(); }
    else if(!moved) flipNext();
  }, {passive:true});

  // keyboard
  document.addEventListener('keydown', e=>{ if(isAnimating) return; if(e.key==='ArrowRight') flipNext(); if(e.key==='ArrowLeft') flipPrev(); });

  // init actions after preload
  preloadImages().then(()=> {
    // subtle cover wiggle to invite click
    const coverLeaf = leaves[0];
    coverLeaf.style.transition = 'transform 700ms cubic-bezier(.2,.9,.25,1)';
    setTimeout(()=>{ coverLeaf.style.transform = 'rotateY(-24deg) translateZ(0.02px)'; playPageSound(); }, 600);
    setTimeout(()=>{ coverLeaf.style.transform = 'rotateY(0deg) translateZ(0.02px)'; }, 1200);
    // attempt autoplay music
    bgMusic.volume = 0.22;
    bgMusic.play().then(()=>{ audioOn=true; audioBtn.textContent='üîä M√∫sica ON'; }).catch(()=>{/*blocked*/});
  });

})();
</script>
</body>
</html>

