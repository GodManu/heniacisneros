<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Henia Cisneros ‚Äî Libro</title>
<style>
  :root{
    --desk-dark:#3e2a20;
    --desk-light:#8a694f;
    --leather-1:#3a0f12;   /* cuero burdeos oscuro */
    --leather-2:#4a2030;
    --gold:#c9a84f;
    --paper:#f7efe0;
    --paper-edge:#e5d6bf;
    --stitch:#d2b27a;
  }

  html,body{
    height:100%;margin:0;font-family:Georgia, "Times New Roman", serif;
    background: linear-gradient(180deg,var(--desk-dark),var(--desk-light));
    display:flex;align-items:center;justify-content:center;overflow:hidden;color:#2f241f;
  }

  /* SCENE - desk */
  .scene{
    width:94vw; max-width:1100px; height:86vh; max-height:780px; border-radius:16px;
    box-shadow: 0 40px 120px rgba(0,0,0,0.6), inset 0 6px 28px rgba(255,255,255,0.02);
    background:
      linear-gradient(180deg, rgba(0,0,0,0.08), rgba(255,255,255,0.02)),
      url('https://images.unsplash.com/photo-1505691723518-36a45b89acb1?auto=format&fit=crop&w=1400&q=80') center/cover no-repeat;
    position:relative; padding:36px; display:flex; align-items:center; justify-content:center;
  }

  /* BOOK WRAPPER (slightly lower to look supported on desk) */
  .book-wrap{
    width:720px; max-width:86%; height:540px; max-height:86%; perspective:3600px;
    display:flex; align-items:center; justify-content:center; position:relative; transform: translateY(6%);
  }
  .book-shadow { position:absolute; bottom:6%; width:56%; height:26px; background:radial-gradient(closest-side, rgba(0,0,0,0.6), transparent); filter:blur(18px); z-index:1; }

  /* BOOK (single bounding box for cover/pages/backcover) */
  .book{
    width:560px; height:430px; position:relative; transform-style:preserve-3d; z-index:10; transition: transform 900ms cubic-bezier(.2,.9,.25,1);
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }

  /* COVER & BACKCOVER */
  .cover, .backcover{
    position:absolute; left:0; top:0; width:100%; height:100%; border-radius:12px; box-sizing:border-box;
    display:flex; align-items:flex-start; justify-content:center; padding:26px 28px; backface-visibility:hidden;
    transform-style:preserve-3d; will-change:transform; overflow:visible;
  }

  /* Leather look + integrated gold border (subtle metal reflect) */
  .cover{
    background:
      linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.03)),
      radial-gradient(1200px 400px at 10% 10%, rgba(255,255,255,0.02), transparent),
      linear-gradient(180deg, var(--leather-1), var(--leather-2));
    box-shadow: 0 20px 60px rgba(0,0,0,0.66), inset 0 8px 26px rgba(255,255,255,0.02);
    border: 6px solid rgba(0,0,0,0.45);
    transform-origin:left center;
    position:relative;
  }

  /* gold frame integrated */
  .cover .gold-edge{
    position:absolute; inset:12px; border-radius:10px; pointer-events:none;
    box-shadow:
      0 0 0 3px rgba(201,168,79,0.12),
      inset 0 0 12px rgba(255,240,180,0.02);
    mask-image: linear-gradient(#000, #000); /* keep subtle */
  }

  /* Title top-left, embossed style */
  .cover .title{
    width:100%;
    text-align:left;
    color:var(--gold);
    font-family: "Cormorant Garamond", Georgia, serif;
    font-size:1.6rem;
    letter-spacing:0.6px;
    margin-top:8px;
    margin-left:18px;
    padding:8px 0;
    text-shadow: 0 2px 6px rgba(0,0,0,0.7);
    font-weight:700;
  }
  .cover .subtitle{
    width:100%; text-align:left; margin-left:18px; color: rgba(255, 239, 200, 0.92); font-size:0.92rem; margin-top:4px; font-style:italic;
    text-shadow: 0 1px 3px rgba(0,0,0,0.5);
  }

  /* BACKCOVER */
  .backcover{
    transform-origin:right center;
    transform: rotateY(180deg);
    background:
      linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.02)),
      linear-gradient(180deg, var(--leather-2), var(--leather-1));
    border:6px solid rgba(0,0,0,0.34);
    box-shadow: 0 10px 40px rgba(0,0,0,0.55), inset 0 6px 18px rgba(255,255,255,0.02);
  }
  .stitch{ position:absolute; right:26px; top:12%; height:76%; width:10px; display:flex; flex-direction:column; align-items:center; justify-content:space-between; z-index:120; }
  .stitch span{ display:block; width:6px; height:6px; background:var(--stitch); border-radius:2px; box-shadow:0 2px 2px rgba(0,0,0,0.25); transform:rotate(12deg); opacity:0.98 }

  /* PAGES container sized exactly like cover/backcover */
  .pages{ position:absolute; left:0; top:0; width:100%; height:100%; transform-style:preserve-3d; pointer-events:auto; z-index:50; }

  /* PAGE visual */
  .page{
    position:absolute; left:0; top:0; width:100%; height:100%; border-radius:10px; box-sizing:border-box;
    background: linear-gradient(180deg, #fbf5e9 0%, var(--paper) 30%, #f0e7d6 100%);
    border:1px solid rgba(0,0,0,0.06);
    padding:28px; overflow:hidden; transform-origin:left center; backface-visibility:hidden;
    transition: transform 720ms cubic-bezier(.2,.9,.25,1), box-shadow 360ms ease;
    display:flex; align-items:center; justify-content:center; will-change: transform;
  }

  /* page edge to simulate stacked paper */
  .page::after{
    content:''; position:absolute; right:-16px; top:12px; bottom:12px; width:22px; border-radius:4px;
    background: linear-gradient(180deg, var(--paper-edge), rgba(0,0,0,0.02)); box-shadow: inset 0 0 8px rgba(0,0,0,0.06);
  }

  .inner{
    width:88%; height:86%; border-radius:6px; padding:18px; box-sizing:border-box;
    background:
      radial-gradient(circle at 50% 30%, rgba(255,255,255,0.12), rgba(255,255,255,0.02) 25%),
      linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.01)),
      url('https://www.transparenttextures.com/patterns/white-waves.png');
    display:flex; align-items:center; justify-content:center; text-align:center; color:#3b2d26; font-size:1.02rem; line-height:1.6;
    box-shadow: inset 0 2px 8px rgba(0,0,0,0.04);
  }

  .page img{ width:100%; height:100%; object-fit:cover; border-radius:6px; box-shadow:0 6px 18px rgba(0,0,0,0.12) inset; }

  /* motion states */
  .page.turning{ transform: rotateY(-92deg) translateX(8px) scale(1.01); box-shadow: -36px 18px 90px rgba(0,0,0,0.6); z-index:9999 !important; }
  .page.flipped{ transform: rotateY(-180deg) translateX(-12px); box-shadow:-10px 14px 36px rgba(0,0,0,0.42); z-index:5 !important; }

  /* controls */
  .controls{ position:absolute; bottom:20px; left:0; right:0; display:flex; justify-content:center; gap:14px; pointer-events:none; z-index:160; }
  .btn{ pointer-events:auto; background: linear-gradient(180deg,#fff,#f7efe1); border-radius:12px; padding:10px 16px; border:1px solid rgba(0,0,0,0.06); font-weight:700; cursor:pointer; box-shadow:0 10px 28px rgba(0,0,0,0.18); opacity:0; transform:translateY(8px); transition:opacity .28s, transform .28s;}
  .book-wrap:hover .btn, .book-wrap.touching .btn{ opacity:1; transform:translateY(0); }

  .top-controls{ position:absolute; top:12px; right:18px; display:flex; gap:10px; z-index:190; }
  .top-controls button{ background:rgba(255,255,255,0.94); border:1px solid rgba(0,0,0,0.06); padding:8px 10px; border-radius:8px; cursor:pointer; font-weight:700 }

  /* final note (appears when fully closed at end) */
  .final-note{
    position:absolute; left:50%; transform:translateX(-50%); bottom:7%; padding:14px 18px; background:rgba(255,255,255,0.95); border-radius:12px; box-shadow:0 12px 30px rgba(0,0,0,0.25);
    font-weight:700; display:none; z-index:220;
  }

  /* responsive */
  @media (max-width:720px){
    .book{ width:86vw; height:74vw; }
    .inner{ font-size:0.95rem; padding:12px; }
    .cover .title{ font-size:1.15rem; margin-left:12px }
    .cover .subtitle{ font-size:0.8rem }
    .final-note{ bottom:6%; font-size:0.95rem; }
  }
</style>
</head>
<body>
  <div class="scene" id="scene">
    <div class="book-wrap" id="bookWrap">
      <div class="book-shadow" aria-hidden="true"></div>

      <div class="book" id="book">
        <!-- COVER -->
        <div class="cover" id="cover" aria-hidden="false">
          <div class="gold-edge" aria-hidden="true"></div>
          <div>
            <div class="title">Henia Cisneros</div>
            <div class="subtitle">Con todo mi cari√±o en tu cumplea√±os</div>
          </div>
        </div>

        <!-- PAGES -->
        <div class="pages" id="pages">
          <div class="page" data-index="0">
            <div class="inner"><img src="img/pagina1.jpg" alt="Foto 1"></div>
          </div>
           </div>
          <div class="page" data-index="1">
            <div class="inner">
              <div>
                <p style="margin:0;"><strong>Querida Henia,</strong><br><br>
                Hoy celebramos no solo tu d√≠a, sino la hermosa historia que has construido. Gracias por tu amor, tu sabidur√≠a y por regalar al mundo una hija tan maravillosa. Este peque√±o libro es un reflejo del cari√±o que sentimos por ti.</p>
              </div>
            </div>
          </div>

          <div class="page" data-index="2">
            <div class="inner"><img src="img/pagina2.jpg" alt="Foto 2"></div>
          </div>

          <div class="page" data-index="3">
            <div class="inner"><img src="img/pagina3.jpg" alt="Foto 3"></div>
          </div>

          <div class="page" data-index="4">
            <div class="inner">
              <div>
                <p style="margin:0;">Que nunca falte en tu vida la alegr√≠a, la paz y la sonrisa que siempre te acompa√±a. Eres inspiraci√≥n, fortaleza y dulzura.</p>
                <p style="margin-top:26px; font-weight:700;">Con cari√±o,<br>Manuel</p>
              </div>
            </div>
          </div>
        </div><!-- /pages -->

        <!-- BACK COVER -->
        <div class="backcover" id="backcover" aria-hidden="true">
          <div class="stitch" aria-hidden="true">
            <span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span>
          </div>
        </div>
      </div><!-- /book -->

      <!-- Controls -->
      <div class="controls" role="toolbar" aria-label="Navegaci√≥n del libro">
        <button class="btn" id="prevBtn">‚üµ Atr√°s</button>
        <button class="btn" id="nextBtn">Siguiente ‚ü∂</button>
      </div>

      <!-- Top controls -->
      <div class="top-controls">
        <button id="audioBtn">üîà M√∫sica</button>
        <button id="resetBtn">‚§∫ Volver</button>
      </div>

      <!-- final note -->
      <div class="final-note" id="finalNote">Con cari√±o, Manuel (Pepechuy) </div>
    </div><!-- /book-wrap -->
  </div><!-- /scene -->

  <!-- Audio placeholders (public examples) -->
  <audio id="pageSound" preload="auto">
    <source src="https://www.soundjay.com/books/page-turn-4.mp3" type="audio/mpeg">
  </audio>
  <audio id="bgMusic" preload="auto" loop>
    <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_efc06752a0.mp3?filename=soft-piano-ambient-112191.mp3" type="audio/mpeg">
  </audio>

<script>
(function(){
  // Elements
  const book = document.getElementById('book');
  const pagesContainer = document.getElementById('pages');
  let pageEls = Array.from(pagesContainer.querySelectorAll('.page'));
  const cover = document.getElementById('cover');
  const backcover = document.getElementById('backcover');
  const nextBtn = document.getElementById('nextBtn');
  const prevBtn = document.getElementById('prevBtn');
  const resetBtn = document.getElementById('resetBtn');
  const audioBtn = document.getElementById('audioBtn');
  const pageSound = document.getElementById('pageSound');
  const bgMusic = document.getElementById('bgMusic');
  const bookWrap = document.getElementById('bookWrap');
  const finalNote = document.getElementById('finalNote');

  let current = 0;
  let audioOn = false;
  let isAnimating = false;

  // Helpers
  function syncSizing(){
    const r = book.getBoundingClientRect();
    [cover, backcover, pagesContainer].forEach(el=>{
      el.style.width = r.width + 'px';
      el.style.height = r.height + 'px';
    });
    pageEls.forEach(p=>{ p.style.width = r.width + 'px'; p.style.height = r.height + 'px'; });
  }
  setTimeout(syncSizing, 30);
  window.addEventListener('resize', syncSizing);

  function updateZIndices(){
    pageEls.forEach((p, i) => {
      if(p.classList.contains('flipped')){
        p.style.zIndex = 10 + i; // behind
      } else {
        p.style.zIndex = 2000 - i*2; // above
      }
    });
    cover.style.zIndex = 3000;
    backcover.style.zIndex = 2500;
  }
  updateZIndices();

  function playPageSound(){
    try{
      if(pageSound && pageSound.querySelector('source') && audioOn){
        pageSound.currentTime = 0;
        pageSound.play().catch(()=>{});
      }
    }catch(e){}
  }
  function tryPlayBg(){
    try{
      if(bgMusic && bgMusic.querySelector('source') && audioOn){
        bgMusic.volume = 0.22;
        bgMusic.play().then(()=> audioBtn.textContent='üîä M√∫sica ON').catch(()=>{ audioBtn.textContent='üîà M√∫sica (pulsa)'; });
      } else {
        audioBtn.textContent = (audioOn? 'üîä Sonidos ON' : 'üîà M√∫sica');
      }
    }catch(e){}
  }

  // Prevent interaction while animating
  function lock() { isAnimating = true; bookWrap.classList.add('anim'); }
  function unlock(){ isAnimating = false; bookWrap.classList.remove('anim'); }

  // Flip next
  function flipNext(){
    if(isAnimating) return;
    if(current >= pageEls.length){
      closeToBackCover();
      return;
    }
    const page = pageEls[current];
    if(!page) return;
    lock();
    // raise page for animation
    page.style.zIndex = 6000;
    page.classList.add('turning');
    // small cover tilt on first flip
    if(current === 0){
      cover.style.transition = 'transform 520ms cubic-bezier(.2,.9,.25,1)';
      cover.style.transform = 'rotateY(-130deg) translateZ(0.01px)';
    }
    playPageSound();
    // use requestAnimationFrame to avoid paint flicker in some browsers
    requestAnimationFrame(()=>{
      setTimeout(()=>{
        page.classList.remove('turning');
        page.classList.add('flipped');
        current++;
        updateZIndices();
        unlock();
        if(current === pageEls.length){
          setTimeout(()=>{ backcover.style.transform = 'rotateY(0deg)'; cover.style.transform = 'rotateY(0deg)'; }, 380);
          setTimeout(()=> showFinalNote(), 900);
        }
      }, 420);
    });
  }

  // Flip prev
  function flipPrev(){
    if(isAnimating) return;
    if(current <= 0) return;
    lock();
    const idx = current - 1;
    const page = pageEls[idx];
    if(!page){ unlock(); return; }
    // bring front and unflip
    page.style.zIndex = 6000;
    page.classList.remove('flipped');
    playPageSound();
    setTimeout(()=>{
      updateZIndices();
      unlock();
    }, 420);
    current--;
    backcover.style.transform = 'rotateY(180deg)';
    hideFinalNote();
    if(current === 0) cover.style.transform = 'rotateY(0deg)';
    else cover.style.transform = 'rotateY(-140deg)';
  }

  // Close to backcover
  function closeToBackCover(){
    if(isAnimating) return;
    lock();
    for(let i = current; i < pageEls.length; i++){
      const p = pageEls[i];
      p.classList.add('flipped');
    }
    updateZIndices();
    current = pageEls.length;
    setTimeout(()=>{
      backcover.style.transform = 'rotateY(0deg)';
      cover.style.transform = 'rotateY(0deg)';
      showFinalNote();
      unlock();
    }, 420);
  }

  // Final note UX
  function showFinalNote(){
    finalNote.style.display = 'block';
    finalNote.style.opacity = '0';
    finalNote.style.transform = 'translateX(-50%) translateY(6px)';
    setTimeout(()=>{ finalNote.style.transition = 'opacity 420ms, transform 420ms'; finalNote.style.opacity='1'; finalNote.style.transform='translateX(-50%) translateY(0)'; }, 40);
  }
  function hideFinalNote(){
    finalNote.style.transition = 'opacity 220ms, transform 220ms';
    finalNote.style.opacity = '0';
    finalNote.style.transform = 'translateX(-50%) translateY(6px)';
    setTimeout(()=>{ finalNote.style.display = 'none'; }, 240);
  }

  // UI events
  nextBtn.addEventListener('click', flipNext);
  prevBtn.addEventListener('click', flipPrev);
  resetBtn.addEventListener('click', ()=>{
    if(isAnimating) return;
    pageEls.forEach(p=> p.classList.remove('flipped','turning'));
    current = 0;
    updateZIndices();
    backcover.style.transform = 'rotateY(180deg)';
    cover.style.transform = 'rotateY(0deg)';
    hideFinalNote();
  });

  audioBtn.addEventListener('click', ()=>{
    audioOn = !audioOn;
    tryPlayBg();
    if(!audioOn){ try{ bgMusic.pause(); audioBtn.textContent='üîà M√∫sica'; }catch(e){} }
  });

  // Click on bookWrap: left edge prev, right edge next, center next
  bookWrap.addEventListener('click', (ev)=>{
    if(isAnimating) return;
    const rect = ev.currentTarget.getBoundingClientRect();
    const x = ev.clientX - rect.left;
    const edge = Math.max(40, rect.width*0.12);
    if(x > rect.width - edge) flipNext();
    else if(x < edge) flipPrev();
    else flipNext();
  });

  // Swipe support
  let startX = 0, startY = 0, moved = false;
  bookWrap.addEventListener('touchstart', (e)=>{
    const t = e.touches[0];
    startX = t.clientX; startY = t.clientY; moved=false;
    bookWrap.classList.add('touching');
  }, {passive:true});
  bookWrap.addEventListener('touchmove', ()=>{ moved=true; }, {passive:true});
  bookWrap.addEventListener('touchend', (e)=>{
    bookWrap.classList.remove('touching');
    if(isAnimating) return;
    const t = e.changedTouches[0];
    const dx = t.clientX - startX;
    const dy = t.clientY - startY;
    const absDx = Math.abs(dx), absDy = Math.abs(dy);
    if(absDx > 30 && absDx > absDy){
      if(dx < 0) flipNext(); else flipPrev();
    } else {
      if(!moved) flipNext();
    }
  }, {passive:true});

  // Keyboard
  document.addEventListener('keydown', (e)=>{
    if(isAnimating) return;
    if(e.key === 'ArrowRight') flipNext();
    if(e.key === 'ArrowLeft') flipPrev();
  });

  // initial states
  backcover.style.transform = 'rotateY(180deg)';
  updateZIndices();

  // Auto open sequence (2.5s) with smooth steps (no flicker)
  function autoOpen(){
    cover.style.transition = 'transform 700ms cubic-bezier(.2,.9,.25,1)';
    setTimeout(()=>{ cover.style.transform = 'rotateY(-120deg) translateZ(0.01px)'; }, 60);
    setTimeout(()=>{ cover.style.transform = 'rotateY(-150deg) translateZ(0.01px)'; try{ if(pageSound && pageSound.querySelector('source')) { pageSound.currentTime = 0; pageSound.play().catch(()=>{}); } }catch(e){} }, 380);
    setTimeout(()=>{ cover.style.transform = 'rotateY(-140deg) translateZ(0.01px)'; }, 920);
  }

  function tryAutoPlayMusic(){
    try{
      if(bgMusic && bgMusic.querySelector('source')){
        bgMusic.volume = 0.22;
        bgMusic.play().then(()=> { audioOn = true; audioBtn.textContent='üîä M√∫sica ON'; })
        .catch(()=>{ audioOn = false; audioBtn.textContent='üîà M√∫sica'; });
      }
    }catch(e){}
  }

  // Start after small delay
  setTimeout(()=>{
    syncSizing();
    autoOpen();
    tryAutoPlayMusic();
  }, 2500);

  // Refresh pages if DOM changes
  function refreshPages(){ pageEls = Array.from(document.querySelectorAll('.page')); updateZIndices(); syncSizing(); }
  window.addEventListener('resize', ()=>{ syncSizing(); refreshPages(); });

  // Debug helpers
  window._bookDebug = { flipNext, flipPrev, updateZIndices, syncSizing, refreshPages };
  console.log('Versi√≥n final cargada. Reemplaza img/pagina*.jpg y audio si deseas.');

})();
</script>
</body>
</html>
