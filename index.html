<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Felicidades — Tarjeta para mi Suegra</title>
  <style>
    :root{
      --bg:#f3ead6; /* papel antiguo */
      --accent:#8b5e3c; /* marrón dorado */
      --deep:#2b1f16;
      --paper:#fffaf0;
      --shadow: rgba(0,0,0,0.25);
    }
    html,body{height:100%;margin:0;font-family: 'Georgia', serif;background:var(--bg);color:var(--deep)}
    /* textura sutil */
    body::before{
      content:"";position:fixed;inset:0;background-image:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));pointer-events:none;mix-blend-mode:multiply;}

    .container{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:2rem;}

    /* Card alrededor del libro */
    .card{width:96%;max-width:980px;background:linear-gradient(180deg,#fffaf3, #f1e6d6);box-shadow: 0 10px 30px var(--shadow);border-radius:16px;padding:28px;display:flex;gap:24px;align-items:center}

    /* Lado izquierdo: controls e introducción */
    .info{flex:0 0 320px}
    .title{font-family: 'Georgia', serif;font-size:1.6rem;color:var(--accent);margin:0 0 6px}
    .subtitle{font-style:italic;color:#6b4f3a;margin:0 0 12px}
    .controls{display:flex;flex-direction:column;gap:10px}
    .btn{background:var(--accent);color:white;border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
    .btn.secondary{background:transparent;color:var(--accent);border:2px solid var(--accent);}
    .small{font-size:0.9rem;color:#4d3a2b}

    /* Lado derecho: el libro */
    .book-wrap{flex:1;display:flex;align-items:center;justify-content:center}
    .book{width:640px;max-width:78vw;height:420px;perspective:2000px;position:relative}

    /* Base del libro (cubiertas) */
    .cover{
      position:absolute;inset:0;transform-style:preserve-3d;transition:transform 1s;transform-origin:left center;z-index:40;
    }
    .cover .face{
      position:absolute;inset:0;border-radius:8px;background:linear-gradient(180deg,#4a2b19,#6b3e28);box-shadow: 0 12px 30px rgba(0,0,0,0.4);border:6px solid rgba(0,0,0,0.06);
      display:flex;align-items:center;justify-content:center;color:var(--paper);font-weight:700;font-size:1.3rem;text-shadow:0 2px 4px rgba(0,0,0,0.35)
    }

    .book.open .cover{transform: rotateY(-140deg);}

    /* página base */
    .pages{position:absolute;inset:20px 26px;z-index:20;display:block;height:calc(100% - 40px);width:calc(100% - 52px);pointer-events:none}

    .page{
      position:absolute;left:0;top:0;width:50%;height:100%;transform-origin:left center;transform-style:preserve-3d;transition:transform 0.9s cubic-bezier(.2,.8,.2,1), z-index 0s;box-shadow: 0 8px 24px rgba(0,0,0,0.12);
      pointer-events:auto;overflow:hidden;border-radius:4px;background:var(--paper);
    }

    /* página frontal (la que gira) */
    .page.front{left:0;z-index:30}
    .page.back{left:50%;transform-origin:right center;z-index:10}

    .page .inner{position:absolute;inset:10px;background:linear-gradient(180deg,rgba(255,255,255,0.5), rgba(0,0,0,0.02));display:flex;flex-direction:column;align-items:center;justify-content:center;padding:18px;border-radius:3px}

    .page img{max-width:100%;max-height:100%;object-fit:cover;border-radius:4px;box-shadow:inset 0 0 0 1px rgba(0,0,0,0.04)}
    .page .caption{margin-top:10px;font-size:0.95rem;color:#5a4030;text-align:center}

    /* flipped pages (simular pasar página) */
    .flipped{transform: rotateY(-180deg);z-index:5}

    /* stack adicional - para varias páginas */
    .page-stack{position:absolute;inset:0;pointer-events:none}

    /* controles de audio */
    .audio-control{display:flex;gap:10px;align-items:center;margin-top:8px}
    .audio-control button{padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:transparent}

    /* Texto editable/dedicatoria */
    .dedication{margin-top:14px;background:rgba(255,255,255,0.6);padding:12px;border-radius:8px;border:1px solid rgba(0,0,0,0.04)}
    .dedication textarea{width:100%;height:110px;border:0;background:transparent;font-family:Georgia,serif;font-size:0.95rem;resize:vertical}

    /* responsive */
    @media(max-width:900px){
      .card{flex-direction:column;align-items:stretch;padding:18px}
      .info{order:2}
      .book{height:360px}
    }
    @media(max-width:520px){
      .book{height:320px}
      .info{flex:1 1 auto}
      .title{font-size:1.2rem}
    }

    /* borde decorativo veracruz - pequeño sello */
    .sello{position:absolute;right:18px;bottom:18px;background:transparent;color:var(--accent);font-weight:700;font-style:italic}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="info">
        <h1 class="title">Felicidades — Tarjeta digital</h1>
        <p class="subtitle">Estilo: Libro vintage elegante + minimal</p>
        <div class="controls">
          <label class="small">Agregar fotos (se crearán páginas):</label>
          <input id="files" type="file" accept="image/*" multiple />
          <div style="display:flex;gap:8px;margin-top:6px;">
            <button class="btn" id="openBtn">Abrir libro</button>
            <button class="btn secondary" id="resetBtn">Limpiar páginas</button>
          </div>

          <div class="audio-control">
            <button id="playAudio" class="btn secondary">Reproducir arpa jarocha</button>
            <button id="pauseAudio" class="btn secondary">Pausar</button>
          </div>

          <div class="dedication">
            <label class="small">Dedicatoria (edítala aquí y pega dentro de una página):</label>
            <textarea id="dedText">Querida suegra, gracias por ser una madre ejemplar y por criar a una hija tan maravillosa. Con cariño, [Tu familia]</textarea>
            <div style="display:flex;gap:8px;margin-top:8px;">
              <button id="addDed" class="btn">Añadir dedicatoria como página</button>
              <button id="addBlank" class="btn secondary">Añadir página en blanco</button>
            </div>
          </div>

          <p style="margin-top:12px;font-size:0.85rem;color:#4d3a2b">Consejo: puedes arrastrar tus imágenes aquí o pulsar "Agregar fotos". Las páginas se pueden pasar tocando el libro o con los botones de teclado ← →.</p>
        </div>
      </div>

      <div class="book-wrap">
        <div class="book" id="book">
          <div class="cover" id="cover">
            <div class="face">Muchas Felicidades</div>
          </div>

          <div class="pages" id="pages">
            <!-- Páginas generadas dinámicamente -->
          </div>

          <div class="sello">VERACRUZ</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Audio: reemplaza src por la URL de tu archivo de arpa jarocha (mp3) o deja vacío y súbelo localmente -->
  <audio id="audio" loop>
    <!-- Ejemplo: <source src="tu-arpa-jarocha.mp3" type="audio/mpeg"> -->
  </audio>

  <script>
    const book = document.getElementById('book');
    const pagesEl = document.getElementById('pages');
    const files = document.getElementById('files');
    const openBtn = document.getElementById('openBtn');
    const resetBtn = document.getElementById('resetBtn');
    const audio = document.getElementById('audio');
    const playAudio = document.getElementById('playAudio');
    const pauseAudio = document.getElementById('pauseAudio');
    const addDed = document.getElementById('addDed');
    const addBlank = document.getElementById('addBlank');
    const dedText = document.getElementById('dedText');

    let pageCount = 0;
    let flippedCount = 0;

    function createImagePage(src){
      const page = document.createElement('div');
      page.className = 'page front';
      page.style.width = '50%';
      page.style.left = '0';

      const inner = document.createElement('div');
      inner.className = 'inner';

      const img = document.createElement('img');
      img.src = src;
      inner.appendChild(img);

      const caption = document.createElement('div');
      caption.className = 'caption';
      caption.textContent = '';
      inner.appendChild(caption);

      page.appendChild(inner);

      // página de atrás con fondo neutro donde se puede colocar texto
      const back = document.createElement('div');
      back.className = 'page back';
      back.style.left = '50%';
      const bInner = document.createElement('div');
      bInner.className = 'inner';
      const p = document.createElement('p');
      p.className = 'caption';
      p.textContent = '';
      bInner.appendChild(p);
      back.appendChild(bInner);

      // insert stack order: each new page goes on top
      pagesEl.appendChild(back);
      pagesEl.appendChild(page);
      pageCount += 2; // front + back

      // click para pasar/retroceder
      page.addEventListener('click', ()=>{
        toggleFlip(page);
      });
      back.addEventListener('click', ()=>{toggleFlip(page)});
    }

    function createTextPage(text){
      const page = document.createElement('div');
      page.className = 'page front';
      page.style.left='0';
      const inner = document.createElement('div');
      inner.className='inner';
      const el = document.createElement('div');
      el.style.fontSize='1.05rem';el.style.lineHeight='1.5';el.style.textAlign='center';el.style.padding='10px';el.textContent = text;
      inner.appendChild(el);
      page.appendChild(inner);

      const back = document.createElement('div');
      back.className='page back';back.style.left='50%';
      const bInner = document.createElement('div');bInner.className='inner';back.appendChild(bInner);

      pagesEl.appendChild(back);
      pagesEl.appendChild(page);
      pageCount += 2;

      page.addEventListener('click', ()=>{toggleFlip(page)});
      back.addEventListener('click', ()=>{toggleFlip(page)});
    }

    function toggleFlip(page){
      // flip this page and manage ordering
      page.classList.toggle('flipped');
      // when flipped, move it behind others visually
      if(page.classList.contains('flipped')){
        page.style.zIndex = 5;
      } else {
        page.style.zIndex = 30;
      }
    }

    files.addEventListener('change', (e)=>{
      const list = Array.from(e.target.files);
      if(!list.length) return;
      list.forEach(file=>{
        const reader = new FileReader();
        reader.onload = function(ev){
          createImagePage(ev.target.result);
        }
        reader.readAsDataURL(file);
      });
      // abrir libro automáticamente
      book.classList.add('open');
    });

    openBtn.addEventListener('click', ()=>{
      book.classList.toggle('open');
    });

    resetBtn.addEventListener('click', ()=>{
      pagesEl.innerHTML='';pageCount=0;flippedCount=0;book.classList.remove('open');
    });

    playAudio.addEventListener('click', ()=>{
      if(!audio.querySelector('source')){
        alert('No hay audio configurado. Reemplaza el elemento <audio> en el HTML con la URL de tu pista de arpa jarocha (mp3).');
        return;
      }
      audio.play();
    });
    pauseAudio.addEventListener('click', ()=>{audio.pause();});

    addDed.addEventListener('click', ()=>{
      createTextPage(dedText.value);
      book.classList.add('open');
    });
    addBlank.addEventListener('click', ()=>{createTextPage('');book.classList.add('open')});

    // navegación con teclado
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'ArrowRight'){
        // encontrar primer page.front que no tenga class flipped
        const p = pagesEl.querySelector('.page.front:not(.flipped)');
        if(p) toggleFlip(p);
      }
      if(e.key === 'ArrowLeft'){
        const p = pagesEl.querySelectorAll('.page.front.flipped');
        const last = p[p.length-1];
        if(last) toggleFlip(last);
      }
    });

    // Drag & drop support básico
    window.addEventListener('dragover', (e)=>{e.preventDefault();});
    window.addEventListener('drop', (e)=>{
      e.preventDefault();
      const dt = e.dataTransfer;
      if(dt && dt.files && dt.files.length){
        Array.from(dt.files).forEach(file=>{
          if(file.type.startsWith('image/')){
            const r = new FileReader();
            r.onload = (ev)=> createImagePage(ev.target.result);
            r.readAsDataURL(file);
          }
        })
        book.classList.add('open');
      }
    });

    // Sugerencia para el usuario: cómo reemplazar el audio con arpa jarocha.
    console.log('Instrucciones: para agregar arpa jarocha, añade dentro del <audio id="audio"> un <source src="URL_DE_TU_MP3" type="audio/mpeg">.');

  </script>
</body>
</html>
